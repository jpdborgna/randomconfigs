# =============================================================================
# tmux.conf — Setup Instructions
# =============================================================================
#
# This config uses TPM (Tmux Plugin Manager) and the Catppuccin theme with
# Nerd Font glyphs. Follow the steps below for your OS, then see the
# "TPM bootstrap" section at the bottom of this file to uncomment the
# correct `run` line for your platform.
#
# ── Debian / Ubuntu ──────────────────────────────────────────────────────────
#
#   1. Install tmux and TPM:
#        sudo apt update && sudo apt install -y tmux tmux-plugin-manager
#
#   2. Install a Nerd Font (needed for Catppuccin rounded glyphs).
#      Download from https://www.nerdfonts.com/font-downloads — e.g.
#      JetBrainsMono Nerd Font — then:
#        mkdir -p ~/.local/share/fonts
#        cp *.ttf ~/.local/share/fonts/
#        fc-cache -fv
#      If you're on WSL2, install the font on Windows instead and set it
#      in Windows Terminal (Settings → Profile → Appearance → Font face).
#
#   3. Copy this file to ~/.tmux.conf
#
#   4. Make sure the TPM bootstrap line near the bottom uses the Debian path:
#        run '/usr/share/tmux-plugin-manager/tpm'
#      (this is the default in this file)
#
#   5. Launch tmux, then press  Prefix + I  (capital I) to install plugins.
#
# ── macOS (Homebrew) ─────────────────────────────────────────────────────────
#
#   1. Install tmux:
#        brew install tmux
#
#   2. Install TPM via git clone:
#        git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
#
#   3. Install a Nerd Font:
#        brew install --cask font-jetbrains-mono-nerd-font
#      Then set your terminal emulator (iTerm2 / Alacritty / etc.) to use
#      "JetBrainsMono Nerd Font".
#
#   4. Copy this file to ~/.tmux.conf
#
#   5. Change the TPM bootstrap line near the bottom to the git-clone path:
#        run '~/.tmux/plugins/tpm/tpm'
#      (comment out the Debian line and uncomment the macOS one)
#
#   6. Launch tmux, then press  Prefix + I  (capital I) to install plugins.
#
# ── Updating plugins ─────────────────────────────────────────────────────────
#   Prefix + U          — update all plugins
#   Prefix + alt + u    — remove/clean plugins not in the list
#
# =============================================================================

##### Core #####

# Prefix: keep default C-b (no override)
set -g prefix C-b
bind-key C-b send-prefix

# Indexing + timings
set -g base-index 1
setw -g pane-base-index 1
set -g repeat-time 300
set -sg escape-time 0

# Truecolor
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",tmux-256color:Tc"

# Big history
set -g history-limit 200000

# Vim copy mode + mouse
setw -g mode-keys vi
set -g mouse on

# Don’t let apps rename windows automatically (pane titles are OK)
set -g allow-rename off
setw -g automatic-rename off

# Splits inherit current directory
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Vim pane movement
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes (hold prefix, then repeat)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick pane zoom
bind z resize-pane -Z

# Reload config
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

##### Copy to Windows clipboard via OSC 52 #####

# Enter copy-mode is default: Prefix + [
# Make v start selection (vim-like) and y copy to Windows clipboard
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "sh -lc 'printf \"\033]52;c;%s\a\" \"$(tmux save-buffer - | base64 -w0)\"'"

# Mouse drag selection also copies (nice for quick grabs)
bind-key -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "sh -lc 'printf \"\033]52;c;%s\a\" \"$(tmux save-buffer - | base64 -w0)\"'"

##### Activity / alerts #####

setw -g monitor-activity on
set -g visual-activity on
set -g bell-action any
set -g visual-bell off

##### Safety rails #####

bind x confirm-before -p "Kill pane #P? (y/n)" kill-pane
bind & confirm-before -p "Kill window #W? (y/n)" kill-window

##### Mouse toggle #####

bind m if -F '#{mouse}' \
  'set -g mouse off \; display-message "mouse: OFF"' \
  'set -g mouse on  \; display-message "mouse: ON"'

##### SSH helpers (best-effort: driven by pane title) #####
# These rely on pane_title being like user@host:cwd (we’ll set that in your shell, next section)

# Split a new pane and ssh to the same host as current pane title (if it looks like user@host)
bind S run-shell -b 't="$(tmux display -p "#{pane_title}")"; h="$(printf "%s" "$t" | sed -n "s/^\([^@]*@[^:]*\).*/\1/p")"; if [ -n "$h" ]; then tmux split-window -v -c "#{pane_current_path}" "ssh $h"; else tmux display-message "No user@host in pane title"; fi'

# Reconnect in the same pane: sends "ssh user@host" into the pane
bind R run-shell -b 't="$(tmux display -p "#{pane_title}")"; h="$(printf "%s" "$t" | sed -n "s/^\([^@]*@[^:]*\).*/\1/p")"; if [ -n "$h" ]; then tmux send-keys -l "ssh $h"; tmux send-keys Enter; else tmux display-message "No user@host in pane title"; fi'

##### Plugins (TPM) #####

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Persistence
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'off'
set -g @continuum-save-interval '0'

# Theme: Catppuccin Mocha
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavour 'mocha'
set -g @catppuccin_window_status_style 'rounded'
set -g @catppuccin_pane_border_style 'thin'

# Make the status actually useful for SSH:
# - pane_title (from shell) gives you remote user@host:cwd
# - directory is local pane path (still useful)
set -g @catppuccin_status_modules_left  'session'
set -g @catppuccin_status_modules_right 'pane_title directory host date_time'

# TPM bootstrap — uncomment the line that matches your OS:
# Debian/Ubuntu (apt install tmux-plugin-manager):
run '/usr/share/tmux-plugin-manager/tpm'
# macOS / manual git clone:
# run '~/.tmux/plugins/tpm/tpm'

##### Direct pane jump: Alt+number (no prefix) #####

bind -n M-1 select-pane -t 1
bind -n M-2 select-pane -t 2
bind -n M-3 select-pane -t 3
bind -n M-4 select-pane -t 4
bind -n M-5 select-pane -t 5
bind -n M-6 select-pane -t 6
